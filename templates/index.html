<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta content="width=device-width, initial-scale=1.0" name="viewport" />
        <title>IPApi - IP Address Information</title>
        <meta
            name="description"
            content="Get detailed information about any IP address or domain. Lookup location, network, and more with our free IP geolocation API."
        />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="{{ request.base_url }}" />
        <meta property="og:title" content="IPApi - IP Address Information Tool" />
        <meta
            property="og:description"
            content="Free IP geolocation service. Find location data, network information, and more for any IP address or domain."
        />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:url" content="{{ request.base_url }}" />
        <meta name="twitter:title" content="IPApi - IP Address Information" />
        <meta
            name="twitter:description"
            content="Get detailed information about any IP address or domain. Free IP geolocation API with no rate limits."
        />
        <link rel="canonical" href="{{ request.base_url }}" />
        <meta
            name="keywords"
            content="IP lookup, geolocation, IP address information, IP API, IP geolocation, domain lookup, network information"
        />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github.min.css"
            id="hljs-light-theme"
            rel="stylesheet"
        />
        <link
            disabled=""
            href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/styles/github-dark.min.css"
            id="hljs-dark-theme"
            rel="stylesheet"
        />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/languages/json.min.js"></script>
        <style>
            :root {
                --background: #f8f9fa;
                --text: #212529;
                --primary: #4285f4;
                --primary-dark: #3367d6;
                --secondary: #34a853;
                --accent: #fbbc05;
                --danger: #ea4335;
                --surface: #ffffff;
                --border: #c9cfd6;
                --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                --code-background: #f5f7f9;
                --tor-badge-color: #9b59b6;
                --text-rgb: 33, 37, 41;
            }

            .leaflet-control-zoom a {
                background-color: #f9f9f7 !important;
                color: #333 !important;
                border: 1px solid #d4dadc !important;
            }
            .leaflet-control-zoom a:hover {
                background-color: #d4dadc !important;
            }
            .leaflet-control-attribution {
                background-color: rgba(249, 249, 247, 0.8) !important;
                color: #333 !important;
            }
            .leaflet-control-attribution a {
                color: #0078a8 !important;
            }
            .leaflet-popup-content-wrapper,
            .leaflet-popup-tip {
                background-color: #f9f9f7 !important;
                color: #333 !important;
                box-shadow: 0 3px 14px rgba(0, 0, 0, 0.2) !important;
            }
            .leaflet-bar,
            .leaflet-control {
                background-color: #f9f9f7 !important;
                border-color: #d4dadc !important;
            }
            .leaflet-bar a {
                background-color: #f9f9f7 !important;
                color: #333 !important;
                border-bottom: 1px solid #d4dadc !important;
            }
            .leaflet-bar a:hover {
                background-color: #d4dadc !important;
            }

            @media (prefers-color-scheme: dark) {
                :root {
                    --background: #121212;
                    --text: #e9ecef;
                    --primary: #5c9aff;
                    --primary-dark: #4285f4;
                    --secondary: #4ecca3;
                    --accent: #ffcc40;
                    --danger: #ff5c5c;
                    --surface: #1e1e1e;
                    --border: #333333;
                    --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
                    --code-background: #2a2a2a;
                    --tor-badge-color: #59316b;
                    --text-rgb: 233, 236, 239;
                }

                .leaflet-control-zoom a {
                    background-color: #090909 !important;
                    color: #eee !important;
                    border: 1px solid #262626 !important;
                }
                .leaflet-control-zoom a:hover {
                    background-color: #262626 !important;
                }
                .leaflet-control-attribution {
                    background-color: rgba(9, 9, 9, 0.8) !important;
                    color: #ccc !important;
                }
                .leaflet-control-attribution a {
                    color: #8ab4f8 !important;
                }
                .leaflet-popup-content-wrapper,
                .leaflet-popup-tip {
                    background-color: #090909 !important;
                    color: #eee !important;
                    box-shadow: 0 3px 14px rgba(0, 0, 0, 0.5) !important;
                }
                .leaflet-bar,
                .leaflet-control {
                    background-color: #090909 !important;
                    border-color: #262626 !important;
                }
                .leaflet-bar a {
                    background-color: #090909 !important;
                    color: #eee !important;
                    border-bottom: 1px solid #262626 !important;
                }
                .leaflet-bar a:hover {
                    background-color: #262626 !important;
                }
            }

            html.dark-theme {
                --background: #121212;
                --text: #e9ecef;
                --primary: #5c9aff;
                --primary-dark: #4285f4;
                --secondary: #4ecca3;
                --accent: #ffcc40;
                --danger: #ff5c5c;
                --surface: #1e1e1e;
                --border: #333333;
                --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
                --code-background: #2a2a2a;
                --tor-badge-color: #59316b;
                --text-rgb: 233, 236, 239;
                transition:
                    background-color 0.3s,
                    color 0.3s;
            }

            html.dark-theme .leaflet-control-zoom a {
                background-color: #090909 !important;
                color: #eee !important;
                border: 1px solid #262626 !important;
            }
            html.dark-theme .leaflet-control-zoom a:hover {
                background-color: #262626 !important;
            }
            html.dark-theme .leaflet-control-attribution {
                background-color: rgba(9, 9, 9, 0.8) !important;
                color: #ccc !important;
            }
            html.dark-theme .leaflet-control-attribution a {
                color: #8ab4f8 !important;
            }
            html.dark-theme .leaflet-popup-content-wrapper,
            html.dark-theme .leaflet-popup-tip {
                background-color: #090909 !important;
                color: #eee !important;
                box-shadow: 0 3px 14px rgba(0, 0, 0, 0.5) !important;
            }
            html.dark-theme .leaflet-bar,
            html.dark-theme .leaflet-control {
                background-color: #090909 !important;
                border-color: #262626 !important;
            }
            html.dark-theme .leaflet-bar a {
                background-color: #090909 !important;
                color: #eee !important;
                border-bottom: 1px solid #262626 !important;
            }
            html.dark-theme .leaflet-bar a:hover {
                background-color: #262626 !important;
            }

            html.light-theme {
                --background: #f8f9fa;
                --text: #212529;
                --primary: #4285f4;
                --primary-dark: #3367d6;
                --secondary: #34a853;
                --accent: #fbbc05;
                --danger: #ea4335;
                --surface: #ffffff;
                --border: #c9cfd6;
                --card-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                --code-background: #f5f7f9;
                --tor-badge-color: #9b59b6;
                --text-rgb: 33, 37, 41;
                transition:
                    background-color 0.3s,
                    color 0.3s;
            }

            html.light-theme .leaflet-control-zoom a {
                background-color: #f9f9f7 !important;
                color: #333 !important;
                border: 1px solid #d4dadc !important;
            }
            html.light-theme .leaflet-control-zoom a:hover {
                background-color: #d4dadc !important;
            }
            html.light-theme .leaflet-control-attribution {
                background-color: rgba(249, 249, 247, 0.8) !important;
                color: #333 !important;
            }
            html.light-theme .leaflet-control-attribution a {
                color: #0078a8 !important;
            }
            html.light-theme .leaflet-popup-content-wrapper,
            html.light-theme .leaflet-popup-tip {
                background-color: #f9f9f7 !important;
                color: #333 !important;
                box-shadow: 0 3px 14px rgba(0, 0, 0, 0.2) !important;
            }
            html.light-theme .leaflet-bar,
            html.light-theme .leaflet-control {
                background-color: #f9f9f7 !important;
                border-color: #d4dadc !important;
            }
            html.light-theme .leaflet-bar a {
                background-color: #f9f9f7 !important;
                color: #333 !important;
                border-bottom: 1px solid #d4dadc !important;
            }
            html.light-theme .leaflet-bar a:hover {
                background-color: #d4dadc !important;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu,
                    Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                background-color: var(--background);
                color: var(--text);
                line-height: 1.6;
                transition:
                    background-color 0.3s,
                    color 0.3s;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            .container {
                width: 100%;
                max-width: 1200px;
                margin: 0 auto;
                padding: 0 20px;
            }

            main {
                flex: 1;
                position: relative;
            }

            .hero {
                height: 66.6vh;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .logo {
                text-align: center;
                margin-bottom: 2rem;
            }

            .logo h1 {
                font-size: 3.5rem;
                font-weight: 800;
                color: var(--primary);
                letter-spacing: -1px;
            }

            .search-container {
                max-width: 600px;
                margin: 0 auto;
            }

            .search-wrapper {
                display: flex;
                position: relative;
                margin-bottom: 1rem;
            }

            #search-input {
                width: 100%;
                padding: 16px 20px;
                border-radius: 50px;
                border: 2px solid var(--border);
                background-color: var(--surface);
                color: var(--text);
                font-size: 1.1rem;
                transition: all 0.3s ease;
                outline: none;
                min-width: 300px;
            }

            #search-input:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.3);
            }

            #search-button {
                position: absolute;
                right: 8px;
                top: 50%;
                transform: translateY(-50%);
                background-color: var(--primary);
                color: white;
                border: none;
                width: 44px;
                height: 44px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                opacity: 0;
                pointer-events: none;
            }

            #search-button.visible {
                opacity: 1;
                pointer-events: auto;
                animation: slideIn 0.3s forwards;
            }

            #search-button:hover {
                background-color: var(--primary-dark);
                transform: translateY(-50%) scale(1.05);
            }

            #search-button svg {
                fill: white;
            }

            .action-buttons {
                display: flex;
                justify-content: center;
                gap: 1rem;
            }

            .action-buttons button {
                padding: 10px 16px;
                border: none;
                border-radius: 20px;
                background-color: var(--surface);
                color: var(--primary);
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s ease;
                border: 1px solid var(--border);
                position: relative;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }

            .spinner {
                display: inline-block;
                width: 16px;
                height: 16px;
                border: 2px solid rgba(66, 133, 244, 0.3);
                border-top-color: var(--primary);
                border-radius: 50%;
                animation: spinner 0.8s linear infinite;
                margin-right: 6px;
                vertical-align: middle;
            }

            @keyframes spinner {
                to {
                    transform: rotate(360deg);
                }
            }

            .action-buttons button:hover {
                background-color: var(--primary);
                color: white;
                box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
            }

            .documentation {
                background-color: var(--surface);
                padding: 4rem 0;
                border-top: 1px solid var(--border);
            }

            .documentation h2 {
                font-size: 2rem;
                margin-bottom: 1rem;
                color: var(--text);
            }

            .documentation p {
                margin-bottom: 2rem;
                color: var(--text);
                opacity: 0.8;
            }

            .endpoint-card {
                background-color: var(--surface);
                border-radius: 8px;
                overflow: hidden;
                border: 1px solid var(--border);
                box-shadow: var(--card-shadow);
                margin-bottom: 2rem;
                transition:
                    transform 0.2s ease,
                    box-shadow 0.2s ease;
            }

            .endpoint-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }

            .endpoint-header {
                padding: 1rem;
                display: flex;
                align-items: center;
                gap: 1rem;
                background-color: var(--code-background);
                border-bottom: 1px solid var(--border);
            }

            .method {
                background-color: var(--primary);
                color: white;
                padding: 4px 8px;
                border-radius: 4px;
                font-weight: bold;
                font-size: 0.9rem;
            }

            .endpoint-url-container {
                display: flex;
                align-items: center;
                flex-wrap: wrap;
                gap: 0.5rem;
                flex: 1;
            }

            .base-url {
                font-family: monospace;
                font-size: 1rem;
            }

            #endpoint-input {
                padding: 8px 12px;
                border-radius: 4px;
                border: 1px solid var(--border);
                background-color: var(--surface);
                color: var(--text);
                font-family: monospace;
                font-size: 1rem;
                width: 200px;
                max-width: 100%;
            }

            #try-endpoint {
                padding: 8px 16px;
                border-radius: 4px;
                border: none;
                background-color: var(--primary);
                color: white;
                cursor: pointer;
                transition: background-color 0.2s;
            }

            #try-endpoint:hover {
                background-color: var(--primary-dark);
            }

            .endpoint-response {
                padding: 0;
                overflow: hidden;
            }

            .response-header {
                padding: 0.75rem 1rem;
                background-color: var(--code-background);
                border-bottom: 1px solid var(--border);
                font-weight: 500;
            }

            pre {
                margin: 0;
                overflow-x: auto;
            }

            code {
                font-family: 'Fira Code', monospace;
                font-size: 0.9rem;
            }

            .hljs {
                background-color: var(--code-background) !important;
                padding: 1.5rem !important;
            }

            .docs-link {
                text-align: center;
                margin-top: 2rem;
            }

            .full-docs-link {
                display: inline-block;
                color: var(--primary);
                text-decoration: none;
                font-weight: 500;
                transition: color 0.2s;
            }

            .full-docs-link:hover {
                color: var(--primary-dark);
                text-decoration: underline;
            }

            footer {
                padding: 2rem 0;
                background-color: var(--background);
                border-top: 1px solid var(--border);
                position: relative;
                z-index: 1;
                margin-top: auto;
            }

            footer .container {
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .theme-toggle {
                display: flex;
                align-items: center;
                gap: 8px;
                cursor: pointer;
                padding: 6px 10px;
                border-radius: 20px;
                transition: background-color 0.2s ease;
            }

            .theme-toggle:hover {
                background-color: rgba(var(--text-rgb, 0, 0, 0), 0.1);
            }

            .theme-toggle-icon {
                width: 20px;
                height: 20px;
                fill: var(--text);
            }

            .theme-toggle-text {
                font-size: 0.9rem;
                color: var(--text);
            }

            .github-link a {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: var(--text);
                text-decoration: none;
                font-weight: 500;
                transition: color 0.2s;
                padding: 6px 10px;
                border-radius: 20px;
                transition: background-color 0.2s ease;
            }

            .github-link a:hover {
                background-color: rgba(var(--text-rgb, 0, 0, 0), 0.1);
            }

            .github-link svg {
                fill: currentColor;
                width: 20px;
                height: 20px;
            }

            .github-link a span {
                font-size: 0.9rem;
            }

            .notification-container {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                pointer-events: none;
            }

            .notification {
                background-color: var(--surface);
                border-left: 4px solid var(--danger);
                border-radius: 4px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                padding: 16px;
                margin-bottom: 10px;
                max-width: 350px;
                opacity: 0;
                transform: translateX(30px);
                transition:
                    opacity 0.3s,
                    transform 0.3s;
                pointer-events: auto;
                position: relative;
                overflow: hidden;
            }

            .notification.show {
                opacity: 1;
                transform: translateX(0);
            }

            .notification-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }

            .notification-title {
                font-weight: 600;
                color: var(--danger);
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .notification-counter {
                font-size: 0.8rem;
                background-color: var(--danger);
                color: white;
                padding: 2px 6px;
                border-radius: 10px;
                font-weight: bold;
            }

            .notification-close {
                background: none;
                border: none;
                cursor: pointer;
                color: var(--text);
                opacity: 0.6;
                transition: opacity 0.2s;
                font-size: 1rem;
                padding: 0;
                width: 20px;
                height: 20px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .notification-close:hover {
                opacity: 1;
            }

            .notification-message {
                color: var(--text);
                font-size: 0.9rem;
                margin-bottom: 8px;
                line-height: 1.4;
            }

            .notification-progress {
                height: 3px;
                background-color: var(--danger);
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                transition: width linear;
            }

            @keyframes slideIn {
                from {
                    transform: translateY(-50%) translateX(20px);
                    opacity: 0;
                }
                to {
                    transform: translateY(-50%) translateX(0);
                    opacity: 1;
                }
            }

            @media (max-width: 768px) {
                .hero {
                    height: auto;
                    padding: 4rem 0;
                }

                .logo h1 {
                    font-size: 2.5rem;
                }

                .endpoint-header {
                    flex-direction: column;
                    align-items: flex-start;
                }

                .endpoint-url-container {
                    width: 100%;
                    margin-top: 0.5rem;
                }

                footer .container {
                    flex-direction: column;
                    gap: 1rem;
                }
            }

            @media (max-width: 480px) {
                .action-buttons {
                    flex-direction: column;
                    gap: 0.5rem;
                }

                .endpoint-url-container {
                    flex-direction: column;
                    align-items: flex-start;
                }

                #endpoint-input {
                    width: 100%;
                }

                #try-endpoint {
                    width: 100%;
                }

                .results-header {
                    padding-top: 1rem;
                    padding-bottom: 1rem;
                }

                .results-logo h1 {
                    font-size: 1.8rem;
                }

                .results-actions {
                    margin-top: 5px;
                }

                footer .container {
                    flex-direction: row;
                    justify-content: space-between;
                    align-items: center;
                    flex-wrap: wrap;
                    gap: 10px;
                }

                footer p {
                    order: 3;
                    width: 100%;
                    text-align: center;
                    margin-top: 10px;
                }

                .theme-toggle {
                    order: 1;
                }

                .github-link {
                    order: 2;
                }

                .result-item {
                    text-align: center;
                }

                .result-label,
                .result-value {
                    text-align: center;
                }

                .results-primary-info {
                    text-align: center;
                }

                .results-section h3 {
                    text-align: center;
                }
            }

            .results-view {
                display: none;
                background-color: var(--background);
                min-height: calc(100vh - 80px);
                opacity: 0;
                transition: opacity 0.4s ease;
                padding-bottom: 2rem;
            }

            .results-view.active {
                display: block;
                opacity: 1;
                min-height: calc(100vh - 80px);
                height: 100%;
            }

            .results-header {
                padding: 1.5rem 0;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .results-logo h1 {
                font-size: 2rem;
                color: var(--primary);
                margin: 0;
            }

            .results-actions {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .results-search-wrapper {
                position: relative;
                display: flex;
                align-items: center;
                max-width: 550px;
                width: 100%;
            }

            #results-search-input {
                width: 100%;
                padding: 12px 16px;
                border-radius: 50px;
                border: 2px solid var(--border);
                background-color: var(--surface);
                color: var(--text);
                font-size: 1rem;
                transition: all 0.3s ease;
                outline: none;
                padding-right: 50px;
                min-width: 300px;
            }

            #results-search-input:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.3);
            }

            #results-search-button {
                position: absolute;
                right: 8px;
                background-color: var(--primary);
                color: white;
                border: none;
                width: 36px;
                height: 36px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            #results-search-button:hover {
                background-color: var(--primary-dark);
                transform: scale(1.05);
            }

            #results-search-button svg {
                fill: white;
                width: 20px;
                height: 20px;
            }

            #close-results {
                background-color: var(--surface);
                color: var(--text);
                border: 1px solid var(--border);
                width: 50px;
                height: 40px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                margin-left: 5px;
                text-decoration: none;
            }

            #close-results:hover {
                background-color: var(--danger);
                color: white;
                transform: scale(1.05);
                box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            }

            #close-results:active {
                transform: scale(0.95);
            }

            #close-results svg {
                fill: currentColor;
                width: 18px;
                height: 18px;
            }

            .results-content {
                margin-top: 1rem;
                min-height: calc(100vh - 100px);
            }

            .results-loading {
                display: none;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 50vh;
            }

            .results-loading.active {
                display: flex;
            }

            .results-spinner {
                width: 50px;
                height: 50px;
                border: 4px solid rgba(66, 133, 244, 0.2);
                border-top-color: var(--primary);
                border-radius: 50%;
                animation: spinner 1s linear infinite;
                margin-bottom: 1rem;
            }

            .results-data {
                display: none;
                flex-direction: column;
                gap: 2rem;
            }

            .results-data.active {
                display: flex;
            }

            .results-map-container {
                width: 100%;
                height: 300px;
                background-color: var(--surface);
                border-radius: 12px;
                overflow: hidden;
                box-shadow: var(--card-shadow);
                border: 1px solid var(--border);
            }

            #ip-map {
                width: 100%;
                height: 100%;
            }

            .results-info-container {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .results-primary-info {
                background-color: var(--surface);
                padding: 1.5rem;
                border-radius: 12px;
                box-shadow: var(--card-shadow);
                text-align: center;
                border: 1px solid var(--border);
                transition:
                    transform 0.2s ease,
                    box-shadow 0.2s ease;
            }

            .results-primary-info:hover {
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }

            .ip-badge {
                display: inline-flex;
                align-items: center;
                background-color: var(--primary);
                color: white;
                padding: 4px 10px;
                border-radius: 50px;
                font-size: 0.8rem;
                font-weight: 500;
                height: 24px;
            }

            .badge-container {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                margin-bottom: 0.5rem;
                justify-content: center;
            }

            .tor-badge {
                display: inline-flex;
                align-items: center;
                background-color: var(--tor-badge-color);
                color: white;
                padding: 4px 10px;
                border-radius: 50px;
                font-size: 0.8rem;
                font-weight: 500;
                gap: 4px;
                height: 24px;
            }

            .tor-badge svg {
                width: 16px;
                height: 16px;
            }

            .results-primary-info h2 {
                font-size: 2.5rem;
                margin: 0;
                margin-bottom: 0.25rem;
                color: var(--text);
                word-break: break-all;
                transition: font-size 0.2s;
            }

            .results-primary-info h2.long-ip {
                font-size: 1.5rem;
            }

            .results-primary-info p {
                font-size: 1.2rem;
                margin: 0;
                color: var(--text);
                opacity: 0.8;
            }

            .results-details {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .results-section {
                background-color: var(--surface);
                padding: 1.5rem;
                border-radius: 12px;
                box-shadow: var(--card-shadow);
                border: 1px solid var(--border);
                transition:
                    transform 0.2s ease,
                    box-shadow 0.2s ease;
            }

            .results-section:hover {
                box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            }

            .results-section h3 {
                margin-top: 0;
                margin-bottom: 1rem;
                color: var(--primary);
                font-size: 1.2rem;
                border-bottom: 1px solid var(--border);
                padding-bottom: 0.5rem;
            }

            .results-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }

            .result-item {
                display: flex;
                flex-direction: column;
            }

            .result-label {
                font-size: 0.9rem;
                color: var(--text);
                opacity: 0.7;
                margin-bottom: 0.25rem;
            }

            .result-value {
                font-size: 1.1rem;
                font-weight: 500;
                word-break: break-word;
            }

            .hero.transitioning {
                animation: fadeOutUp 0.5s forwards;
            }

            .hero.hidden {
                display: none;
            }

            @keyframes fadeOutUp {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(-20px);
                }
            }

            @keyframes fadeInDown {
                from {
                    opacity: 0;
                    transform: translateY(-20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            @media (min-width: 768px) {
                .results-content {
                    margin-top: 2rem;
                }

                .results-data.active {
                    flex-direction: row;
                    flex-wrap: wrap;
                }

                .results-map-container {
                    flex-basis: 100%;
                    height: 400px;
                }

                .results-info-container {
                    flex-direction: row;
                    flex-basis: 100%;
                }

                .results-primary-info {
                    flex: 1;
                }

                .results-details {
                    flex: 2;
                }
            }

            .hero-loading-spinner {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.4);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 10;
                -webkit-backdrop-filter: blur(3px);
                backdrop-filter: blur(3px);
            }

            .hero-loading-spinner .spinner {
                width: 50px;
                height: 50px;
                border: 4px solid rgba(66, 133, 244, 0.2);
                border-top-color: var(--primary);
                border-radius: 50%;
                animation: spinner 1s linear infinite;
                margin-bottom: 1rem;
            }

            .hero-loading-spinner p {
                color: var(--text);
                font-size: 1.1rem;
                font-weight: 500;
            }

            html,
            body {
                height: 100%;
                margin: 0;
                padding: 0;
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu,
                    Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                background-color: var(--background);
                color: var(--text);
                line-height: 1.6;
                transition:
                    background-color 0.3s,
                    color 0.3s;
                min-height: 100vh;
                display: flex;
                flex-direction: column;
            }

            main {
                flex: 1;
                display: flex;
                flex-direction: column;
            }

            @keyframes fadeOut {
                from {
                    opacity: 1;
                    transform: translateY(0);
                }
                to {
                    opacity: 0;
                    transform: translateY(-20px);
                }
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .fade-out {
                animation: fadeOut 0.4s ease forwards;
            }

            .fade-in {
                animation: fadeIn 0.4s ease forwards;
            }

            .ipv4-mapping {
                font-size: 0.9rem;
                color: var(--text);
                opacity: 0.7;
                margin-top: 0.5rem;
            }

            @media (max-width: 768px) {
                .results-header {
                    flex-direction: column;
                    align-items: stretch;
                    gap: 15px;
                }

                .results-logo-nav {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    width: 100%;
                }

                .results-logo {
                    text-align: left;
                }

                .results-actions {
                    flex-direction: column;
                    width: 100%;
                    align-items: center;
                }

                .results-search-wrapper {
                    order: 2;
                    width: 100%;
                    max-width: none;
                    margin-top: 10px;
                }

                #close-results {
                    order: 1;
                    margin: 0;
                    width: 40px;
                }

                #results-search-input {
                    width: 100%;
                    max-width: 100%;
                    min-width: unset;
                }

                .search-container {
                    width: 100%;
                }

                #search-input {
                    min-width: unset;
                }

                #endpoint-input {
                    width: 100%;
                }
            }

            @media (max-width: 480px) {
                .results-header {
                    padding-top: 1rem;
                    padding-bottom: 1rem;
                }

                .results-logo h1 {
                    font-size: 1.8rem;
                }

                .results-actions {
                    margin-top: 5px;
                }
            }
        </style>
    </head>
    <body>
        <main>
            <section class="hero">
                <div class="container">
                    <div class="logo">
                        <h1>IPApi</h1>
                    </div>
                    <div class="search-container">
                        <div class="search-wrapper">
                            <input
                                id="search-input"
                                placeholder="Enter IP, IPv6 or Domain"
                                type="text"
                            />
                            <button class="hidden" id="search-button">
                                <svg
                                    height="24"
                                    viewbox="0 0 24 24"
                                    width="24"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path d="M0 0h24v24H0z" fill="none"></path>
                                    <path d="M16.01 11H4v2h12.01v3L20 12l-3.99-4z"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="action-buttons">
                            <button id="my-ip">My IP</button>
                            <button id="try-example">Try Example</button>
                        </div>
                    </div>
                </div>
            </section>
            <section class="results-view" id="results-view">
                <div class="container">
                    <div class="results-header">
                        <div class="results-logo">
                            <h1>IPApi</h1>
                        </div>
                        <div class="results-actions">
                            <div class="results-search-wrapper">
                                <input
                                    id="results-search-input"
                                    type="text"
                                    placeholder="Enter IP, IPv6 or Domain"
                                />
                                <button id="results-search-button">
                                    <svg
                                        height="24"
                                        viewbox="0 0 24 24"
                                        width="24"
                                        xmlns="http://www.w3.org/2000/svg"
                                    >
                                        <path d="M0 0h24v24H0z" fill="none"></path>
                                        <path d="M16.01 11H4v2h12.01v3L20 12l-3.99-4z"></path>
                                    </svg>
                                </button>
                            </div>
                            <a href="#" id="close-results" aria-label="Close results">
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    height="24"
                                    width="24"
                                    viewBox="0 0 24 24"
                                >
                                    <path d="M0 0h24v24H0z" fill="none" />
                                    <path
                                        d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"
                                    />
                                </svg>
                            </a>
                        </div>
                    </div>
                    <div class="results-content">
                        <div class="results-loading">
                            <div class="results-spinner"></div>
                            <p>Loading IP data...</p>
                        </div>
                        <div class="results-data">
                            <div class="results-map-container">
                                <div id="ip-map"></div>
                            </div>
                            <div class="results-info-container">
                                <div class="results-primary-info">
                                    <div class="badge-container">
                                        <div class="ip-badge">
                                            <span id="result-ip-type">IPv4</span>
                                        </div>
                                        <div class="tor-badge" id="tor-badge" style="display: none">
                                            <svg
                                                viewBox="0 0 512 512"
                                                xmlns="http://www.w3.org/2000/svg"
                                            >
                                                <circle fill="#9B59B6" cx="256" cy="256" r="256" />
                                                <path
                                                    d="M256.5,465.4v-31c98.3-0.3,177.9-80.1,177.9-178.4c0-98.4-79.6-178.1-177.9-178.4v-31c115.4,0.3,208.9,93.9,208.9,209.4 C465.4,371.5,372,465.2,256.5,465.4z"
                                                    fill="#FFFFFF"
                                                />
                                                <path
                                                    d="M256.5,356.8c55.4-0.3,100.3-45.3,100.3-100.8c0-55.5-44.9-100.5-100.3-100.8v-31c72.6,0.3,131.4,59.2,131.4,131.8 c0,72.7-58.8,131.6-131.4,131.9V356.8z"
                                                    fill="#FFFFFF"
                                                />
                                                <path
                                                    d="M256.5,201.7c29.7,0.3,53.8,24.5,53.8,54.3c0,29.8-24,54-53.8,54.3V201.7z"
                                                    fill="#FFFFFF"
                                                />
                                                <path
                                                    d="M256,0 A256,256 0 0 0 256,512 Z"
                                                    fill="#9B59B6"
                                                />
                                            </svg>
                                            <span>Tor</span>
                                        </div>
                                    </div>
                                    <h2 id="result-ip">8.8.8.8</h2>
                                    <p id="result-hostname">dns.google</p>
                                </div>
                                <div class="results-details">
                                    <div class="results-section">
                                        <h3>Location</h3>
                                        <div class="results-grid" id="location-grid">
                                            <!-- Will be populated by JS -->
                                        </div>
                                    </div>
                                    <div class="results-section">
                                        <h3>Network</h3>
                                        <div class="results-grid" id="network-grid">
                                            <!-- Will be populated by JS -->
                                        </div>
                                    </div>
                                    <div class="results-section">
                                        <h3>Abuse</h3>
                                        <div class="results-grid" id="abuse-grid">
                                            <!-- Will be populated by JS -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            <section class="documentation">
                <div class="container">
                    <h2>API Documentation</h2>
                    <p>
                        Get detailed information about any IP address or domain with our simple API.
                    </p>
                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <span class="method">GET</span>
                            <div class="endpoint-url-container">
                                <span class="base-url">{{ request.base_url }}json/</span>
                                <input
                                    id="endpoint-input"
                                    placeholder="1.1.1.1"
                                    type="text"
                                    value="1.1.1.1"
                                />
                                <button id="try-endpoint">Try it</button>
                            </div>
                        </div>
                        <div class="endpoint-response">
                            <div class="response-header">
                                <span>Response</span>
                            </div>
                            <pre><code class="language-json" id="response-example">{
    "ip": "1.1.1.1",
    "hostname": "one.one.one.one",
    "type": "ipv4",
    "continent": "North America",
    "continent_code": "NA",
    "country": "United States",
    "country_code": "US",
    "region": "California",
    "region_code": "CA",
    "city": "Los Angeles",
    "postal_code": "90001",
    "latitude": 34.052571,
    "longitude": -118.243907,
    "timezone": "America/Los_Angeles",
    "currency": "USD",
    "accuracy_radius": 100,
    "asn": 13335,
    "organization": "Cloudflare, Inc.",
    "tor_exit_node": false
}</code></pre>
                        </div>
                    </div>
                    <div class="docs-link">
                        <a class="full-docs-link" href="/docs">View full API documentation </a>
                    </div>
                </div>
            </section>
        </main>
        <footer>
            <div class="container">
                <p> 2025 IPApi. All rights reserved.</p>
                <div class="theme-toggle" id="theme-toggle">
                    <svg
                        class="theme-toggle-icon theme-icon-light"
                        viewBox="0 0 24 24"
                        style="display: none"
                    >
                        <path
                            d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41.39.39 1.03.39 1.41 0l1.06-1.06z"
                        ></path>
                    </svg>
                    <svg
                        class="theme-toggle-icon theme-icon-dark"
                        viewBox="0 0 24 24"
                        style="display: none"
                    >
                        <path
                            d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"
                        ></path>
                    </svg>
                    <span class="theme-toggle-text">Switch Theme</span>
                </div>
                <div class="github-link">
                    <a
                        href="https://github.com/tn3w/ipapi"
                        rel="noopener noreferrer"
                        target="_blank"
                    >
                        <svg
                            height="24"
                            viewbox="0 0 24 24"
                            width="24"
                            xmlns="http://www.w3.org/2000/svg"
                        >
                            <path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
                            ></path>
                        </svg>
                        <span>GitHub</span>
                    </a>
                </div>
            </div>
        </footer>

        <div class="notification-container" id="notification-container"></div>

        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const elements = {
                    search: {
                        input: document.getElementById('search-input'),
                        button: document.getElementById('search-button'),
                        myIpButton: document.getElementById('my-ip'),
                        tryExampleButton: document.getElementById('try-example'),
                    },
                    endpoint: {
                        input: document.getElementById('endpoint-input'),
                        button: document.getElementById('try-endpoint'),
                        responseExample: document.getElementById('response-example'),
                    },
                    results: {
                        view: document.getElementById('results-view'),
                        input: document.getElementById('results-search-input'),
                        button: document.getElementById('results-search-button'),
                        closeButton: document.getElementById('close-results'),
                        loading: document.querySelector('.results-loading'),
                        data: document.querySelector('.results-data'),
                    },
                    theme: {
                        light: document.getElementById('hljs-light-theme'),
                        dark: document.getElementById('hljs-dark-theme'),
                    },
                    toggle: {
                        button: document.getElementById('theme-toggle'),
                        lightIcon: document.querySelector('.theme-icon-light'),
                        darkIcon: document.querySelector('.theme-icon-dark'),
                        text: document.querySelector('.theme-toggle-text'),
                    },
                    hero: document.querySelector('.hero'),
                    notification: document.getElementById('notification-container'),
                };

                const apiBaseUrl = '{{ request.base_url }}json';

                let cachedIP = null;
                let map = null;
                let marker = null;
                let currentQuery = null;
                let activeNotification = null;
                let notificationTimeout = null;
                let lastErrorMessage = '';
                let errorCounter = 1;

                function toggleTheme() {
                    const savedTheme = localStorage.getItem('theme');
                    const prefersDarkMode = window.matchMedia(
                        '(prefers-color-scheme: dark)'
                    ).matches;

                    if (
                        !savedTheme ||
                        (savedTheme === 'dark' && prefersDarkMode) ||
                        (savedTheme === 'light' && !prefersDarkMode)
                    ) {
                        localStorage.setItem('theme', prefersDarkMode ? 'light' : 'dark');
                    } else {
                        localStorage.setItem('theme', savedTheme === 'dark' ? 'light' : 'dark');
                    }

                    updateCodeTheme();
                }

                function updateCodeTheme() {
                    const savedTheme = localStorage.getItem('theme');
                    const prefersDarkMode = window.matchMedia(
                        '(prefers-color-scheme: dark)'
                    ).matches;

                    const useDarkMode =
                        savedTheme === 'dark' || (savedTheme !== 'light' && prefersDarkMode);

                    const htmlElement = document.documentElement;
                    htmlElement.classList.remove('light-theme', 'dark-theme');

                    if (savedTheme) {
                        htmlElement.classList.add(useDarkMode ? 'dark-theme' : 'light-theme');
                    }

                    elements.theme.light.disabled = useDarkMode;
                    elements.theme.dark.disabled = !useDarkMode;

                    if (elements.toggle) {
                        elements.toggle.lightIcon.style.display = useDarkMode ? 'block' : 'none';
                        elements.toggle.darkIcon.style.display = useDarkMode ? 'none' : 'block';
                        elements.toggle.text.textContent = useDarkMode
                            ? 'Switch to Light'
                            : 'Switch to Dark';
                    }

                    document.querySelectorAll('[data-highlighted]').forEach(el => {
                        delete el.dataset.highlighted;
                    });

                    if (window.hljs) hljs.highlightAll();

                    if (map && typeof L !== 'undefined') {
                        map.eachLayer(layer => {
                            if (layer instanceof L.TileLayer) {
                                map.removeLayer(layer);
                            }
                        });

                        const tileUrl = useDarkMode
                            ? 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png'
                            : 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png';

                        L.tileLayer(tileUrl, {
                            attribution:
                                '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' +
                                ' | &copy; <a href="https://carto.com/attributions">CARTO</a>',
                            maxZoom: 19,
                        }).addTo(map);

                        if (marker) {
                            marker.openPopup();
                        }
                    }
                }

                function updateSearchButtonVisibility() {
                    const isEmpty = elements.search.input.value.trim() === '';
                    elements.search.button.classList.toggle('visible', !isEmpty);
                    elements.search.button.classList.toggle('hidden', isEmpty);
                }

                function setupSearchEvents() {
                    updateSearchButtonVisibility();

                    ['input', 'change', 'autocomplete'].forEach(event => {
                        elements.search.input.addEventListener(event, updateSearchButtonVisibility);
                    });

                    elements.search.input.addEventListener('animationstart', e => {
                        if (e.animationName.indexOf('autofill') !== -1)
                            updateSearchButtonVisibility();
                    });

                    elements.search.button.addEventListener('click', () => {
                        const query = elements.search.input.value.trim();
                        if (query) fetchIPData(query);
                    });

                    elements.search.input.addEventListener('keypress', e => {
                        if (e.key === 'Enter' && e.target.value.trim()) {
                            fetchIPData(e.target.value.trim());
                        }
                    });

                    elements.results.button.addEventListener('click', () => {
                        const query = elements.results.input.value.trim();
                        if (query) {
                            elements.search.input.value = query;
                            showLoading();
                            fetchIPData(query);
                        }
                    });

                    elements.results.input.addEventListener('keypress', e => {
                        if (e.key === 'Enter' && e.target.value.trim()) {
                            elements.search.input.value = e.target.value.trim();
                            showLoading();
                            fetchIPData(e.target.value.trim());
                        }
                    });
                }

                function setupHelperButtons() {
                    elements.search.myIpButton.addEventListener('click', async () => {
                        if (cachedIP) {
                            elements.search.input.value = cachedIP;
                            updateSearchButtonVisibility();
                            return;
                        }

                        const originalText = elements.search.myIpButton.textContent;
                        elements.search.myIpButton.innerHTML =
                            '<span class="spinner"></span> Loading...';
                        elements.search.myIpButton.disabled = true;

                        try {
                            const response = await fetch(`${apiBaseUrl}/self?fields=ip`);
                            const data = await response.json();

                            if (data.ip) {
                                cachedIP = data.ip;
                                elements.search.input.value = cachedIP;
                                updateSearchButtonVisibility();
                            } else if (data.detail) {
                                throw new Error(data.detail);
                            } else {
                                throw new Error('Unexpected response format');
                            }
                        } catch (error) {
                            showNotification(
                                'Error',
                                `Error fetching your IP address: ${error.message}. Please try again.`
                            );
                            console.error('Error fetching IP:', error);
                        } finally {
                            elements.search.myIpButton.innerHTML = originalText;
                            elements.search.myIpButton.disabled = false;
                        }
                    });

                    elements.search.tryExampleButton.addEventListener('click', () => {
                        elements.search.input.value = '8.8.8.8';
                        updateSearchButtonVisibility();
                    });

                    elements.endpoint.button.addEventListener('click', async () => {
                        const query = elements.endpoint.input.value.trim();
                        if (!query) return;

                        elements.endpoint.button.textContent = 'Loading...';
                        elements.endpoint.button.disabled = true;

                        try {
                            const response = await fetch(
                                `${apiBaseUrl}/${encodeURIComponent(query)}`
                            );
                            const data = await response.json();
                            elements.endpoint.responseExample.textContent = JSON.stringify(
                                data,
                                null,
                                4
                            );
                            if (window.hljs) {
                                if (elements.endpoint.responseExample.dataset.highlighted) {
                                    delete elements.endpoint.responseExample.dataset.highlighted;
                                }
                                hljs.highlightElement(elements.endpoint.responseExample);
                            }
                        } catch (error) {
                            elements.endpoint.responseExample.textContent = JSON.stringify(
                                {
                                    error: 'An error occurred while fetching data',
                                    message: error.message,
                                },
                                null,
                                4
                            );
                            if (window.hljs) {
                                if (elements.endpoint.responseExample.dataset.highlighted) {
                                    delete elements.endpoint.responseExample.dataset.highlighted;
                                }
                                hljs.highlightElement(elements.endpoint.responseExample);
                            }
                        } finally {
                            elements.endpoint.button.textContent = 'Try it';
                            elements.endpoint.button.disabled = false;
                        }
                    });
                }

                function showLoading() {
                    elements.results.loading.classList.add('active');
                    elements.results.data.classList.remove('active');
                }

                function hideLoading() {
                    elements.results.loading.classList.remove('active');
                }

                function transitionToResultsView(ipData) {
                    elements.results.input.value = elements.search.input.value;

                    if (ipData) prePopulateResultsData(ipData);

                    document.body.classList.add('results-active');
                    elements.results.view.style.display = 'block';
                    elements.results.view.style.opacity = '0';

                    const documentationSection = document.querySelector('.documentation');
                    documentationSection.style.display = 'none';

                    elements.hero.classList.add('fade-out');

                    setTimeout(() => {
                        elements.hero.classList.add('hidden');
                        elements.hero.style.display = 'none';

                        elements.results.view.style.opacity = '';
                        elements.results.view.classList.add('active');
                        elements.results.view.classList.add('fade-in');

                        if (ipData) displayIPData(ipData);

                        window.history.pushState(
                            { view: 'results', query: currentQuery },
                            '',
                            `?ip=${encodeURIComponent(currentQuery)}`
                        );
                    }, 400);
                }

                function transitionToHeroView() {
                    document.body.classList.remove('results-active');
                    elements.results.view.style.display = 'block';
                    elements.results.view.classList.remove('fade-in');
                    elements.results.view.classList.add('fade-out');
                    elements.hero.style.display = 'none';
                    elements.hero.classList.remove('fade-out');

                    setTimeout(() => {
                        elements.results.view.classList.remove('active');
                        elements.results.view.classList.remove('fade-out');
                        elements.results.view.style.display = 'none';

                        const documentationSection = document.querySelector('.documentation');
                        documentationSection.style.display = 'block';

                        elements.hero.classList.remove('hidden');
                        elements.hero.style.display = 'flex';
                        void elements.hero.offsetWidth;
                        elements.hero.classList.add('fade-in');

                        window.history.pushState({ view: 'hero' }, '', window.location.pathname);

                        setTimeout(() => {
                            elements.hero.classList.remove('fade-in');
                        }, 400);
                    }, 400);
                }

                async function fetchIPData(ip) {
                    currentQuery = ip;

                    const isResultsView = elements.results.view.classList.contains('active');
                    if (isResultsView) {
                        showLoading();
                    } else {
                        const loadingSpinner = document.createElement('div');
                        loadingSpinner.className = 'hero-loading-spinner';
                        loadingSpinner.innerHTML =
                            '<div class="spinner"></div><p>Loading IP data...</p>';

                        elements.hero.style.position = 'relative';
                        elements.hero.appendChild(loadingSpinner);
                    }

                    try {
                        const response = await fetch(
                            `${apiBaseUrl}/${encodeURIComponent(ip)}?fields=all`
                        );
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                        const data = await response.json();
                        if (ip !== currentQuery) return;

                        window.ipDataCache = data;

                        if (isResultsView) {
                            displayIPData(data);
                        } else {
                            const loadingSpinner =
                                elements.hero.querySelector('.hero-loading-spinner');
                            if (loadingSpinner) elements.hero.removeChild(loadingSpinner);
                            transitionToResultsView(data);
                        }
                    } catch (error) {
                        if (ip !== currentQuery) return;

                        if (isResultsView) {
                            hideLoading();
                        } else {
                            const loadingSpinner =
                                elements.hero.querySelector('.hero-loading-spinner');
                            if (loadingSpinner) elements.hero.removeChild(loadingSpinner);
                        }

                        showNotification(
                            'Error',
                            `Error fetching IP data: ${error.message}. Please try again.`
                        );
                        console.error('Error fetching IP data:', error);
                    }
                }

                function isValidValue(value) {
                    return (
                        value !== null &&
                        value !== undefined &&
                        value !== 'none' &&
                        value !== 'None' &&
                        value !== ''
                    );
                }

                function prePopulateResultsData(ipData) {
                    const ipTypeEl = document.getElementById('result-ip-type');
                    const ipEl = document.getElementById('result-ip');
                    const hostnameEl = document.getElementById('result-hostname');

                    if (ipTypeEl && ipData.type) ipTypeEl.textContent = ipData.type.toUpperCase();

                    if (ipEl) {
                        ipEl.textContent = ipData.ip || '';
                        ipEl.classList.toggle('long-ip', ipData.ip && ipData.ip.length > 20);
                    }

                    if (hostnameEl)
                        hostnameEl.textContent = isValidValue(ipData.hostname)
                            ? ipData.hostname
                            : 'No hostname available';
                }

                function displayIPData(data) {
                    hideLoading();

                    const resultsDataContainer = document.querySelector('.results-data');
                    if (resultsDataContainer) resultsDataContainer.classList.add('active');

                    const ipTypeEl = document.getElementById('result-ip-type');
                    const ipEl = document.getElementById('result-ip');
                    const hostnameEl = document.getElementById('result-hostname');
                    const torBadgeEl = document.getElementById('tor-badge');

                    if (ipTypeEl) ipTypeEl.textContent = data.type?.toUpperCase() || 'IP';

                    if (ipEl) {
                        ipEl.textContent = data.ip || '';
                        ipEl.classList.toggle('long-ip', data.ip && data.ip.length > 20);

                        const ipv4Container = document.querySelector('.ipv4-mapping');
                        if (data.type === 'ipv6' && isValidValue(data.ipv4)) {
                            if (!ipv4Container) {
                                const container = document.createElement('div');
                                container.className = 'ipv4-mapping';
                                container.textContent = `IPv4 mapping: ${data.ipv4}`;
                                ipEl.parentNode.insertBefore(container, ipEl.nextSibling);
                            } else {
                                ipv4Container.textContent = `IPv4 mapping: ${data.ipv4}`;
                                ipv4Container.style.display = 'block';
                            }
                        } else if (ipv4Container) {
                            ipv4Container.style.display = 'none';
                        }
                    }

                    if (torBadgeEl) {
                        torBadgeEl.style.display =
                            data.tor_exit_node === true ? 'inline-flex' : 'none';
                    }

                    if (hostnameEl)
                        hostnameEl.textContent = isValidValue(data.hostname)
                            ? data.hostname
                            : 'No hostname available';

                    const locationGrid = document.getElementById('location-grid');
                    if (locationGrid) {
                        locationGrid.innerHTML = '';

                        const locationFields = [
                            { key: 'continent', label: 'Continent' },
                            { key: 'country', label: 'Country' },
                            { key: 'region', label: 'Region' },
                            { key: 'city', label: 'City' },
                            { key: 'county', label: 'County' },
                            { key: 'postal_code', label: 'Postal Code' },
                            { key: 'timezone', label: 'Timezone' },
                        ];

                        locationFields.forEach(field => {
                            if (isValidValue(data[field.key])) {
                                addResultItem(locationGrid, field.label, data[field.key]);

                                if (field.key === 'timezone' && isValidValue(data.offset)) {
                                    const offsetHours = data.offset / 3600;
                                    const sign = offsetHours >= 0 ? '+' : '';
                                    const formattedOffset = `GMT${sign}${offsetHours}`;
                                    addResultItem(locationGrid, 'GMT Offset', formattedOffset);
                                }
                            }
                        });

                        const remainingFields = [
                            { key: 'currency', label: 'Currency' },
                            { key: 'accuracy_radius', label: 'Accuracy Radius' },
                        ];

                        remainingFields.forEach(field => {
                            if (isValidValue(data[field.key])) {
                                addResultItem(locationGrid, field.label, data[field.key]);
                            }
                        });

                        if (isValidValue(data.latitude)) {
                            addResultItem(locationGrid, 'Latitude', data.latitude);
                        }
                        if (isValidValue(data.longitude)) {
                            addResultItem(locationGrid, 'Longitude', data.longitude);
                        }
                    }

                    const networkGrid = document.getElementById('network-grid');
                    if (networkGrid) {
                        networkGrid.innerHTML = '';

                        const showAsnName = data.asn_name !== data.organization;

                        const networkFields = [
                            { key: 'asn', label: 'ASN' },
                            ...(showAsnName ? [{ key: 'asn_name', label: 'ASN Name' }] : []),
                            { key: 'organization', label: 'Organization' },
                            { key: 'net', label: 'Network' },
                        ];

                        networkFields.forEach(field => {
                            if (isValidValue(data[field.key])) {
                                addResultItem(networkGrid, field.label, data[field.key]);
                            }
                        });
                    }

                    const abuseGrid = document.getElementById('abuse-grid');
                    if (abuseGrid) {
                        abuseGrid.innerHTML = '';

                        addResultItem(
                            abuseGrid,
                            'Tor Exit Node',
                            data.tor_exit_node === true ? 'Yes' : 'No'
                        );
                    }

                    initializeMap(data.latitude, data.longitude, data.ip);
                }

                function addResultItem(container, label, value) {
                    const item = document.createElement('div');
                    item.className = 'result-item';

                    const labelEl = document.createElement('div');
                    labelEl.className = 'result-label';
                    labelEl.textContent = label;

                    const valueEl = document.createElement('div');
                    valueEl.className = 'result-value';
                    valueEl.textContent = value;

                    item.appendChild(labelEl);
                    item.appendChild(valueEl);
                    container.appendChild(item);
                }

                function initializeMap(lat, lon, ipAddress) {
                    if (
                        !isValidValue(lat) ||
                        !isValidValue(lon) ||
                        isNaN(parseFloat(lat)) ||
                        isNaN(parseFloat(lon))
                    ) {
                        document.getElementById('ip-map').innerHTML =
                            '<div style="height:100%;display:flex;align-items:center;justify-content:center;padding:1rem;text-align:center;">Location coordinates not available for this IP address.</div>';
                        return;
                    }

                    try {
                        lat = parseFloat(lat);
                        lon = parseFloat(lon);

                        if (lat < -90 || lat > 90 || lon < -180 || lon > 180) {
                            document.getElementById('ip-map').innerHTML =
                                '<div style="height:100%;display:flex;align-items:center;justify-content:center;padding:1rem;text-align:center;">Invalid location coordinates for this IP address.</div>';
                            return;
                        }

                        if (!window.L) {
                            const linkElement = document.createElement('link');
                            linkElement.rel = 'stylesheet';
                            linkElement.href =
                                'https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css';
                            document.head.appendChild(linkElement);

                            const scriptElement = document.createElement('script');
                            scriptElement.src =
                                'https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js';
                            document.head.appendChild(scriptElement);

                            scriptElement.onload = () => createMap(lat, lon, ipAddress);
                        } else {
                            createMap(lat, lon, ipAddress);
                        }
                    } catch (error) {
                        console.error('Error initializing map:', error);
                        document.getElementById('ip-map').innerHTML =
                            '<div style="height:100%;display:flex;align-items:center;justify-content:center;padding:1rem;text-align:center;">Error loading map.</div>';
                    }
                }

                function createMap(lat, lon, ipAddress) {
                    const mapContainer = document.getElementById('ip-map');
                    const prefersDarkMode = window.matchMedia(
                        '(prefers-color-scheme: dark)'
                    ).matches;

                    const savedTheme = localStorage.getItem('theme');
                    const useDarkMode =
                        savedTheme === 'dark' || (savedTheme !== 'light' && prefersDarkMode);

                    const htmlElement = document.documentElement;
                    const hasDarkClass = htmlElement.classList.contains('dark-theme');
                    const finalUseDarkMode =
                        (savedTheme && hasDarkClass) ||
                        (!savedTheme && prefersDarkMode) ||
                        useDarkMode;

                    if (!map) {
                        map = L.map(mapContainer).setView([lat, lon], 10);

                        const tileUrl = finalUseDarkMode
                            ? 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png'
                            : 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png';

                        const tileLayer = L.tileLayer(tileUrl, {
                            attribution:
                                '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors' +
                                ' | &copy; <a href="https://carto.com/attributions">CARTO</a>',
                            maxZoom: 19,
                        }).addTo(map);

                        tileLayer.once('load', function () {
                            if (!marker) {
                                marker = L.marker([lat, lon])
                                    .addTo(map)
                                    .bindPopup(`IP: ${ipAddress}<br>Lat: ${lat}<br>Lon: ${lon}`)
                                    .openPopup();

                                map.invalidateSize();
                            }
                        });

                        map.once('moveend', function () {
                            if (!marker) {
                                marker = L.marker([lat, lon])
                                    .addTo(map)
                                    .bindPopup(`IP: ${ipAddress}<br>Lat: ${lat}<br>Lon: ${lon}`)
                                    .openPopup();

                                map.invalidateSize();
                            }
                        });
                    } else {
                        map.setView([lat, lon], 10);

                        if (marker) {
                            marker
                                .setLatLng([lat, lon])
                                .bindPopup(`IP: ${ipAddress}<br>Lat: ${lat}<br>Lon: ${lon}`)
                                .openPopup();
                        } else {
                            marker = L.marker([lat, lon])
                                .addTo(map)
                                .bindPopup(`IP: ${ipAddress}<br>Lat: ${lat}<br>Lon: ${lon}`)
                                .openPopup();
                        }

                        map.invalidateSize();
                    }
                }

                function showNotification(title, message, duration = 4000) {
                    if (message === lastErrorMessage) {
                        errorCounter++;

                        if (activeNotification) {
                            const counterElement =
                                activeNotification.querySelector('.notification-counter');
                            if (counterElement) {
                                counterElement.textContent = `x${errorCounter}`;
                            } else {
                                const titleElement =
                                    activeNotification.querySelector('.notification-title');
                                const counter = document.createElement('span');
                                counter.className = 'notification-counter';
                                counter.textContent = `x${errorCounter}`;
                                titleElement.appendChild(counter);
                            }

                            const progressBar =
                                activeNotification.querySelector('.notification-progress');
                            if (progressBar) {
                                progressBar.style.transition = 'none';
                                progressBar.style.width = '100%';
                                setTimeout(() => {
                                    progressBar.style.transition = `width ${duration}ms linear`;
                                    progressBar.style.width = '0';
                                }, 50);
                            }

                            if (notificationTimeout) clearTimeout(notificationTimeout);
                            notificationTimeout = setTimeout(hideNotification, duration);

                            return;
                        }
                    } else {
                        lastErrorMessage = message;
                        errorCounter = 1;
                    }

                    if (activeNotification) hideNotification();

                    const notification = document.createElement('div');
                    notification.className = 'notification';

                    notification.innerHTML = `
                        <div class="notification-header">
                            <div class="notification-title">
                                <span>${title}</span>
                                ${errorCounter > 1 ? `<span class="notification-counter">x${errorCounter}</span>` : ''}
                            </div>
                            <button class="notification-close" aria-label="Close notification">&times;</button>
                        </div>
                        <div class="notification-message">${message}</div>
                        <div class="notification-progress"></div>
                    `;

                    elements.notification.appendChild(notification);
                    notification.offsetHeight;
                    notification.classList.add('show');

                    const progressBar = notification.querySelector('.notification-progress');
                    progressBar.style.width = '100%';
                    setTimeout(() => {
                        progressBar.style.transition = `width ${duration}ms linear`;
                        progressBar.style.width = '0';
                    }, 50);

                    const closeButton = notification.querySelector('.notification-close');
                    closeButton.addEventListener('click', hideNotification);

                    notificationTimeout = setTimeout(hideNotification, duration);
                    activeNotification = notification;
                }

                function hideNotification() {
                    if (activeNotification) {
                        activeNotification.classList.remove('show');

                        setTimeout(() => {
                            if (activeNotification && activeNotification.parentNode) {
                                activeNotification.parentNode.removeChild(activeNotification);
                            }
                            activeNotification = null;
                        }, 300);

                        if (notificationTimeout) {
                            clearTimeout(notificationTimeout);
                            notificationTimeout = null;
                        }
                    }
                }

                function updateHeaderStructure() {
                    const resultsHeader = document.querySelector('.results-header');
                    const resultsLogo = document.querySelector('.results-logo');
                    const resultsActions = document.querySelector('.results-actions');
                    const closeButton = document.getElementById('close-results');

                    if (window.innerWidth <= 768) {
                        if (!document.querySelector('.results-logo-nav')) {
                            const logoNav = document.createElement('div');
                            logoNav.className = 'results-logo-nav';

                            if (resultsLogo && closeButton) {
                                resultsHeader.insertBefore(logoNav, resultsActions);
                                logoNav.appendChild(resultsLogo);
                                logoNav.appendChild(closeButton);
                            }
                        }
                    } else {
                        const logoNav = document.querySelector('.results-logo-nav');
                        if (logoNav) {
                            const resultsLogo = logoNav.querySelector('.results-logo');
                            const closeButton = logoNav.querySelector('#close-results');

                            if (resultsLogo && closeButton && resultsHeader && resultsActions) {
                                resultsHeader.insertBefore(resultsLogo, resultsActions);
                                resultsActions.appendChild(closeButton);
                                logoNav.remove();
                            }
                        }
                    }
                }

                function checkUrlForIp() {
                    const urlParams = new URLSearchParams(window.location.search);
                    const ipParam = urlParams.get('ip');

                    if (ipParam) {
                        elements.hero.style.display = 'none';
                        elements.hero.classList.add('hidden');

                        const documentationSection = document.querySelector('.documentation');
                        if (documentationSection) documentationSection.style.display = 'none';

                        elements.results.view.style.display = 'block';
                        elements.results.view.classList.add('active');
                        showLoading();

                        elements.search.input.value = ipParam;
                        elements.results.input.value = ipParam;
                        updateSearchButtonVisibility();

                        document.body.classList.add('results-active');

                        window.history.replaceState(
                            { view: 'results', query: ipParam },
                            '',
                            `?ip=${encodeURIComponent(ipParam)}`
                        );

                        fetchIPData(ipParam);
                    }
                }

                elements.results.closeButton.addEventListener('click', e => {
                    e.preventDefault();
                    transitionToHeroView();
                });

                window.addEventListener('resize', updateHeaderStructure);

                window.addEventListener('popstate', event => {
                    if (event.state && event.state.view === 'results') {
                        const query = event.state.query;
                        if (query) {
                            elements.search.input.value = query;
                            fetchIPData(query);
                        }
                    } else if (elements.results.view.classList.contains('active')) {
                        transitionToHeroView();
                    }
                });

                document.body.classList.add('loaded');
                setupSearchEvents();
                setupHelperButtons();

                if (elements.toggle.button) {
                    elements.toggle.button.addEventListener('click', toggleTheme);
                }

                setTimeout(updateHeaderStructure, 100);
                setTimeout(checkUrlForIp, 0);
                updateCodeTheme();

                window
                    .matchMedia('(prefers-color-scheme: dark)')
                    .addEventListener('change', updateCodeTheme);
            });
        </script>
    </body>
</html>
